From 5b52d4d6fc288bffeee533b87cafa1f89f01719a Mon Sep 17 00:00:00 2001
From: Jaemin Hong <hjm0901@gmail.com>
Date: Thu, 27 Nov 2025 10:49:57 +0000
Subject: [PATCH] fixes

---
 .../B01_organic/hdr_bitrate_lib/test_vectors/101.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/110.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/111.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/112.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/113.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/115.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/117.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/119.json     | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/16.json      | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/32.json      | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/48.json      | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/64.json      | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/80.json      | 1 +
 .../B01_organic/hdr_bitrate_lib/test_vectors/96.json      | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/14.json   | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/15.json   | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/29.json   | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/30.json   | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/81.json   | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/82.json   | 1 +
 Public-Tests/B01_organic/pow43_lib/test_vectors/83.json   | 6 ++++--
 Public-Tests/B01_organic/pow43_lib/test_vectors/84.json   | 1 +
 .../B01_organic/tritanopia_lib/test_vectors/3.json        | 1 +
 .../007_errno-pow_lib/test_case/include/pow.h             | 2 +-
 .../scripts/github-actions/runtests/runners/lib_runner.py | 6 ++++--
 tools/cando2/src/lib.rs                                   | 8 ++++++++
 26 files changed, 39 insertions(+), 5 deletions(-)

diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/101.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/101.json
index 81f52f6..bea4839 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/101.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/101.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 255, 255],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/110.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/110.json
index 7b50c0f..87438e2 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/110.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/110.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 0, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/111.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/111.json
index 253b8bb..db12131 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/111.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/111.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 8, 0],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/112.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/112.json
index 54635f5..713f4b3 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/112.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/112.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 8, 16],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/113.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/113.json
index 8bd51df..7e03171 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/113.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/113.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 8, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/115.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/115.json
index 6d40bc3..b0443aa 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/115.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/115.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 9, 160],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/117.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/117.json
index f8eeb17..1205187 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/117.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/117.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 136, 48],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/119.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/119.json
index f8f89e0..de38ee4 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/119.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/119.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 118, 247],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/16.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/16.json
index e8eaca0..e0c8456 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/16.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/16.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 2, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/32.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/32.json
index 73d5417..e8cc824 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/32.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/32.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 4, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/48.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/48.json
index 44d68fd..86ef180 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/48.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/48.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 6, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/64.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/64.json
index 9a365ab..707a37d 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/64.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/64.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 10, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/80.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/80.json
index 2f369fd..b902cb4 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/80.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/80.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 12, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/96.json b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/96.json
index 42c5036..a0f2b7a 100644
--- a/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/96.json
+++ b/Public-Tests/B01_organic/hdr_bitrate_lib/test_vectors/96.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "h": [0, 14, 240],
     "returns": 0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/14.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/14.json
index b148db4..abef20a 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/14.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/14.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": -64,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/15.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/15.json
index 6075356..a2bc72e 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/15.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/15.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": -100,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/29.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/29.json
index ad742eb..2e9dcdd 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/29.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/29.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": 16384,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/30.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/30.json
index d1b40b3..b57755d 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/30.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/30.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": 32768,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/81.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/81.json
index 6a1957b..c464827 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/81.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/81.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": -129,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/82.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/82.json
index 6be3747..3b83eaf 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/82.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/82.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": -200,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/83.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/83.json
index 677597c..affc607 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/83.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/83.json
@@ -1,7 +1,9 @@
-{ "lib_state_in": {
+{
+  "has_ub": "out of bound",
+  "lib_state_in": {
   "x": -1000,
   "returns": 0.0
 },"lib_state_out": {
   "x": -1000,
   "returns": -2.051766e35
-} }
\ No newline at end of file
+} }
diff --git a/Public-Tests/B01_organic/pow43_lib/test_vectors/84.json b/Public-Tests/B01_organic/pow43_lib/test_vectors/84.json
index 6b72d86..140f22f 100644
--- a/Public-Tests/B01_organic/pow43_lib/test_vectors/84.json
+++ b/Public-Tests/B01_organic/pow43_lib/test_vectors/84.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "out of bound",
   "lib_state_in": {
     "x": 100000,
     "returns": 0.0
diff --git a/Public-Tests/B01_organic/tritanopia_lib/test_vectors/3.json b/Public-Tests/B01_organic/tritanopia_lib/test_vectors/3.json
index 4887130..731639b 100644
--- a/Public-Tests/B01_organic/tritanopia_lib/test_vectors/3.json
+++ b/Public-Tests/B01_organic/tritanopia_lib/test_vectors/3.json
@@ -1,4 +1,5 @@
 {
+  "has_ub": "converting negative float to unsigned int",
 	"lib_state_in": {
 		"rgb": {
 			"r": 92,
diff --git a/Public-Tests/B01_synthetic/007_errno-pow_lib/test_case/include/pow.h b/Public-Tests/B01_synthetic/007_errno-pow_lib/test_case/include/pow.h
index 99a6ea5..ad613ad 100644
--- a/Public-Tests/B01_synthetic/007_errno-pow_lib/test_case/include/pow.h
+++ b/Public-Tests/B01_synthetic/007_errno-pow_lib/test_case/include/pow.h
@@ -24,6 +24,6 @@
 #ifndef ECHO_H_
 #define ECHO_H_
 
-double pow(double base, double exponent);
+double my_pow(double base, double exponent);
 
 #endif //ECHO_H_
diff --git a/deployment/scripts/github-actions/runtests/runners/lib_runner.py b/deployment/scripts/github-actions/runtests/runners/lib_runner.py
index 70854f1..4612256 100644
--- a/deployment/scripts/github-actions/runtests/runners/lib_runner.py
+++ b/deployment/scripts/github-actions/runtests/runners/lib_runner.py
@@ -32,6 +32,8 @@ class LibRunner(TestCaseRunner):
         runner_name   = f"_{Path(test_case.rel_name).name}_runner"
         if rust:
             target_dir = target_dir / "release"
+            if len(list(target_dir.glob("*.so"))) == 0:
+                target_dir = target_dir / "deps"
 
         if not test_dir.is_dir():
             return []
@@ -47,7 +49,7 @@ class LibRunner(TestCaseRunner):
 
             stdin = spec.get("stdin", None)
             exec_path = repo_root / "target" / "release" / runner_name
-            run_cmd   = [exec_path, "lib", "-c", test_name + ".json"]
+            run_cmd   = [exec_path, "lib", "-c", test_name + ".json", "-a", str(target_dir)]
             if verbose:
                 print(f"[test] Running {run_cmd}:{test_name}")
             try:
@@ -59,7 +61,7 @@ class LibRunner(TestCaseRunner):
             
             test_stdout = res.stdout or ""
             test_stderr = res.stderr or ""
-            (new_stdout, count) = re.subn(f"^{test_name}.json: true\n", "", test_stdout)
+            (new_stdout, count) = re.subn(f"{test_name}.json: true\n", "", test_stdout)
             
             # Build expectations and compare
             expected_rc = spec.get("rc", 0)
diff --git a/tools/cando2/src/lib.rs b/tools/cando2/src/lib.rs
index 0f92b0f..5ada9db 100644
--- a/tools/cando2/src/lib.rs
+++ b/tools/cando2/src/lib.rs
@@ -228,6 +228,10 @@ macro_rules! harness {
                 /// run one or more specific test cases
                 #[argh(option, short='c')]
                 case: Vec<String>,
+
+                /// artifact directory
+                #[argh(option, short='a')]
+                artifact: Option<String>,
             }
 
             /// Run tests for a binary candidate
@@ -249,6 +253,10 @@ macro_rules! harness {
                     let mut tcs = std::collections::HashMap::new();
                     let mut json_string = String::new();
 
+                    if let Some(artifact) = lopts.artifact {
+                        ARTIFACT_DIR.set(PathBuf::from(artifact)).unwrap();
+                    }
+
                     if lopts.zero {
                         let mut state = State::zeroed();
 
-- 
2.25.1

